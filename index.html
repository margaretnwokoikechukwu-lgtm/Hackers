<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hackers Code Battle</title>
<style>
body {
    font-family: Arial;
    background: #0f172a;
    color: white;
    text-align: center;
    padding: 20px;
}
.container {
    max-width: 400px;
    margin: auto;
}
input, button, select {
    padding: 10px;
    margin: 5px;
    width: 100%;
    border-radius: 8px;
    border: none;
}
button {
    background: #22c55e;
    color: white;
    font-weight: bold;
}
.log {
    background: #1e293b;
    padding: 10px;
    height: 200px;
    overflow-y: auto;
    text-align: left;
    border-radius: 8px;
}
.hidden {
    display: none;
}
</style>
</head>
<body>

<div class="container">

<h1>Hackers Code Battle</h1>

<div id="startScreen">
<select id="difficulty">
<option value="easy">Easy</option>
<option value="normal">Normal</option>
<option value="hard">Hard</option>
</select>

<input type="password" id="playerSecret" placeholder="Enter your 4-digit secret (no repeats)">
<button onclick="startGame()">Start Game</button>
</div>

<div id="gameScreen" class="hidden">

<h3>Your Turn</h3>
<input id="playerGuess" placeholder="Guess computer code">
<button onclick="playerTurn()">Submit Guess</button>

<h3>Computer Turn</h3>
<p id="computerGuessDisplay"></p>
<input id="deadInput" placeholder="Dead">
<input id="injuredInput" placeholder="Injured">
<button onclick="computerTurn()">Submit Result</button>

<h3>Game Log</h3>
<div class="log" id="log"></div>

</div>

</div>

<script>

let playerSecret = "";
let computerSecret = "";
let difficulty = "";
let candidates = [];
let computerGuess = "";

function startGame() {

playerSecret = document.getElementById("playerSecret").value;
difficulty = document.getElementById("difficulty").value;

if(!validCode(playerSecret)) {
    alert("Invalid secret code!");
    return;
}

computerSecret = generateCode();
generateCandidates();

document.getElementById("startScreen").classList.add("hidden");
document.getElementById("gameScreen").classList.remove("hidden");

log("Game Started! Difficulty: " + difficulty);
}

function validCode(code) {
if(code.length !== 4) return false;
if(new Set(code).size !== 4) return false;
if(!/^\d+$/.test(code)) return false;
return true;
}

function generateCode() {
let digits = "0123456789";
let result = "";
while(result.length < 4) {
let r = digits[Math.floor(Math.random()*10)];
if(!result.includes(r)) result += r;
}
return result;
}

function calculateResult(secret, guess) {
let dead = 0;
let injured = 0;

for(let i=0;i<4;i++) {
if(guess[i] === secret[i]) dead++;
else if(secret.includes(guess[i])) injured++;
}

return {dead, injured};
}

function playerTurn() {

let guess = document.getElementById("playerGuess").value;

if(!validCode(guess)) {
alert("Invalid guess!");
return;
}

let result = calculateResult(computerSecret, guess);

log("You guessed " + guess + " → " + result.dead + " Dead, " + result.injured + " Injured");

if(result.dead === 4) {
alert("You Win!");
location.reload();
}

computerPlay();
}

function computerPlay() {

if(difficulty === "easy") {
computerGuess = generateCode();
}

else if(difficulty === "normal") {
computerGuess = candidates[Math.floor(Math.random()*candidates.length)];
}

else {
computerGuess = candidates[0];
}

document.getElementById("computerGuessDisplay").innerText =
"Computer guesses: " + computerGuess;

if(difficulty === "hard") {
log("Computer analyzing " + candidates.length + " possible codes...");
}
}

function computerTurn() {

let dead = parseInt(document.getElementById("deadInput").value);
let injured = parseInt(document.getElementById("injuredInput").value);

if(isNaN(dead) || isNaN(injured)) {
alert("Enter valid numbers");
return;
}

log("Computer guessed " + computerGuess + 
" → " + dead + " Dead, " + injured + " Injured");

if(dead === 4) {
alert("Computer Wins!");
location.reload();
}

filterCandidates(computerGuess, dead, injured);
}

function generateCandidates() {
candidates = [];
for(let i=0;i<10000;i++) {
let code = i.toString().padStart(4,"0");
if(validCode(code)) candidates.push(code);
}
}

function filterCandidates(guess, dead, injured) {
candidates = candidates.filter(code => {
let result = calculateResult(code, guess);
return result.dead === dead && result.injured === injured;
});
}

function log(text) {
let logDiv = document.getElementById("log");
logDiv.innerHTML += text + "<br>";
logDiv.scrollTop = logDiv.scrollHeight;
}

</script>

</body>
</html>